<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Leaflet.geoCSV Static Example</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
  <style>
    #map { width: 100%; height: 600px; }
  </style>
</head>
<body>
  <h2>Map from Local CSV (Leaflet.geoCSV)</h2>
  <div id="map"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <!-- Leaflet.geoCSV plugin (served via githack CDN) -->
  <script src="https://rawcdn.githack.com/joker-x/Leaflet.geoCSV/master/leaflet.geocsv.js"></script>
  <!-- jQuery for AJAX -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <script>
    // Initialize the map
    var map = L.map('map').setView([51.5, -0.12], 12);

    // Add OpenStreetMap base layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Load local CSV and add as geoCSV layer
    $.get('https://glynnie.github.io/findmyride/finalstops.csv', function(csvContent) {
      var geoCsvLayer = L.geoCsv(csvContent, {
        firstLineTitles: true,
        fieldSeparator: ',',
        latitudeTitle: 'lat',      // Change if your CSV uses different names
        longitudeTitle: 'lng',
        onEachFeature: function(feature, layer) {
          // Use the popup column if present, otherwise show the stop_name
          var popupText = feature.properties.popup || feature.properties.stop_name || "No info";
          layer.bindPopup(popupText);
        }
      });
      geoCsvLayer.addTo(map);
      map.fitBounds(geoCsvLayer.getBounds());
    });
  </script>
</body>
</html>
